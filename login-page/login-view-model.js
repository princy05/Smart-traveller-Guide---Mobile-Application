"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var observable_1 = require("tns-core-modules/data/observable");
var dialogs = require("tns-core-modules/ui/dialogs");
var Login_Page = /** @class */ (function (_super) {
    __extends(Login_Page, _super);
    function Login_Page() {
        var _this = _super.call(this) || this;
        // Initialize default values.
        _this._counter = 42;
        return _this;
    }
    Object.defineProperty(Login_Page.prototype, "message", {
        get: function () {
            return this._message;
        },
        set: function (value) {
            if (this._message !== value) {
                this._message = value;
                this.notifyPropertyChange("message", value);
            }
        },
        enumerable: true,
        configurable: true
    });
    Login_Page.prototype.onTap = function (args) {
        var page = args.object.page;
        var vm = page.bindingContext;
        page.frame.navigate("./Traveler_account/home-page");
    };
    Login_Page.prototype.makePostRequest = function (args) {
        var page = args.object.page;
        var vm = page.bindingContext;
        var num = 1;
        var a = 0;
        var email = vm.get("user");
        var password = vm.get("pass");
        // console.log(email);
        var regexp = new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/i);
        var strongRegex = new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\$%\^&\*])(?=.{8,})");
        if (!email && !password) {
            num = 0;
            dialogs.alert("Both fields mandatory");
        }
        else if (!email) {
            dialogs.alert("Email cannot be empty");
            num = 0;
        }
        else if (email && !regexp.test(email)) {
            num = 0;
            dialogs.alert("Invalid email address.");
        }
        else if (!password) {
            num = 0;
            dialogs.alert("Password cannot be empty");
        }
        else if (password.length < 6) {
            num = 0;
            dialogs.alert("Password should be more than 6 characters ");
        }
        if (num == 1) {
            // >> fetch-post-ts
            fetch("http://ec2-18-218-173-14.us-east-2.compute.amazonaws.com:3000/user/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    email: vm.get("user"),
                    password: vm.get("pass")
                })
            }).then(function (r) { return r.json(); })
                .then(function (response) {
                var result = response;
                // >> (hide)
                if (result.message == "Auth successful") {
                    console.log("Even");
                    page.frame.navigate("./Traveler_account/home-page");
                }
                else {
                    console.log("Email not exists. Please Sign Up !!");
                    dialogs.alert("Email not exists. Please Sign Up !!").then(function () {
                    });
                }
                console.log(result);
            }).catch(function (e) {
                console.log("Error: ");
                console.log(e);
            });
        }
    };
    Login_Page.prototype.admin = function (args) {
        var page = args.object.page;
        var vm = page.bindingContext;
        var num = 1;
        var a = 0;
        var email = vm.get("user");
        var password = vm.get("pass");
        // console.log(email);
        var regexp = new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/i);
        var strongRegex = new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\$%\^&\*])(?=.{8,})");
        if (!email) {
            dialogs.alert("Admin Email cannot be empty");
            num = 0;
        }
        else if (!password) {
            num = 0;
            dialogs.alert("Admin Password cannot be empty");
        }
        else if (!email && !password) {
            num = 0;
            dialogs.alert("Admin Email and password cannot be empty");
        }
        else if (email == "admin1@admin.com") {
            if (password == "admin") {
                page.frame.navigate("./admin/admin-page");
            }
            else {
                dialogs.alert("Admin Password incorrect");
            }
        }
        else {
            dialogs.alert("Admin Email is not correct");
        }
    };
    Login_Page.prototype.signup = function (args) {
        var page = args.object.page;
        var vm = page.bindingContext;
        page.frame.navigate("./signup/signup");
    };
    return Login_Page;
}(observable_1.Observable));
exports.Login_Page = Login_Page;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9naW4tdmlldy1tb2RlbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImxvZ2luLXZpZXctbW9kZWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwrREFBOEQ7QUFDOUQscURBQXVEO0FBSXZEO0lBQWdDLDhCQUFVO0lBS3RDO1FBQUEsWUFDSSxpQkFBTyxTQUtWO1FBSEcsNkJBQTZCO1FBQzdCLEtBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDOztJQUV2QixDQUFDO0lBRUQsc0JBQUksK0JBQU87YUFBWDtZQUNJLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUN6QixDQUFDO2FBRUQsVUFBWSxLQUFhO1lBQ3JCLElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxLQUFLLEVBQUU7Z0JBQ3pCLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO2dCQUN0QixJQUFJLENBQUMsb0JBQW9CLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQy9DO1FBQ0wsQ0FBQzs7O09BUEE7SUFTRCwwQkFBSyxHQUFMLFVBQU0sSUFBSTtRQUVOLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO1FBQzlCLElBQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUM7UUFDL0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsOEJBQThCLENBQUMsQ0FBQztJQUN4RCxDQUFDO0lBRUQsb0NBQWUsR0FBZixVQUFnQixJQUFJO1FBQ2hCLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO1FBQzlCLElBQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUM7UUFDL0IsSUFBSSxHQUFHLEdBQVUsQ0FBQyxDQUFDO1FBQ25CLElBQU0sQ0FBQyxHQUFDLENBQUMsQ0FBQztRQUNWLElBQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7UUFD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RyxJQUFJLENBQUMsY0FBYyxDQUFDO1FBQy9CLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFFM0MsQ0FBQztJQUNHLGlCQUFDO0FBQUQsQ0FBQyxBQTVLTCxDQUFnQyx1QkFBVSxHQTRLckM7QUE1S1EsZ0NBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvZGF0YS9vYnNlcnZhYmxlXCI7XG5pbXBvcnQgKiBhcyBkaWFsb2dzIGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL2RpYWxvZ3NcIjtcblxuaW1wb3J0IHtQYWdlfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy91aS9wYWdlXCI7XG5cbmV4cG9ydCBjbGFzcyBMb2dpbl9QYWdlIGV4dGVuZHMgT2JzZXJ2YWJsZSB7XG5cbiAgICBwcml2YXRlIF9jb3VudGVyOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBfbWVzc2FnZTogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBkZWZhdWx0IHZhbHVlcy5cbiAgICAgICAgdGhpcy5fY291bnRlciA9IDQyO1xuICAgICAgICBcbiAgICB9XG5cbiAgICBnZXQgbWVzc2FnZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5fbWVzc2FnZTtcbiAgICB9XG5cbiAgICBzZXQgbWVzc2FnZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgICAgIGlmICh0aGlzLl9tZXNzYWdlICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5fbWVzc2FnZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5ub3RpZnlQcm9wZXJ0eUNoYW5nZShcIm1lc3NhZ2VcIiwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25UYXAoYXJncykge1xuICAgICAgICBcbiAgICAgICAgY29uc3QgcGFnZSA9IGFyZ3Mub2JqZWN0LnBhZ2U7XG4gICAgICAgIGNvbnN0IHZtID0gcGFnZS5iaW5kaW5nQ29udGV4dDtcbiAgICAgICAgcGFnZS5mcmFtZS5uYXZpZ2F0ZShcIi4vVHJhdmVsZXJfYWNjb3VudC9ob21lLXBhZ2VcIik7XG4gICAgfVxuXG4gICAgbWFrZVBvc3RSZXF1ZXN0KGFyZ3MpIHtcbiAgICAgICAgY29uc3QgcGFnZSA9IGFyZ3Mub2JqZWN0LnBhZ2U7XG4gICAgICAgIGNvbnN0IHZtID0gcGFnZS5iaW5kaW5nQ29udGV4dDtcbiAgICAgICAgdmFyIG51bTpudW1iZXIgPSAxOyBcbiAgICAgICAgY29uc3QgYT0wO1xuICAgICAgICBjb25zdCBlbWFpbCA9IHZtLmdldChcInVzZXJcIik7XG4gICAgICAgIGNvbnN0IHBhc3N3b3JkPXZtLmdldChcInBhc3NcIik7XG4gICAgICAgLy8gY29uc29sZS5sb2coZW1haWwpO1xuICAgIFxuICAgICAgICBjb25zdCByZWdleHAgPSBuZXcgUmVnRXhwKC9eKChbXjw+KClcXFtcXF1cXFxcLiw7Olxcc0BcIl0rKFxcLltePD4oKVxcW1xcXVxcXFwuLDs6XFxzQFwiXSspKil8KFwiLitcIikpQCgoXFxbWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfV0pfCgoW2EtekEtWlxcLTAtOV0rXFwuKStbYS16QS1aXXsyLH0pKSQvaSk7XG4gICAgICAgIGNvbnN0IHN0cm9uZ1JlZ2V4ID0gbmV3IFJlZ0V4cChcIl4oPz0uKlthLXpdKSg/PS4qW0EtWl0pKD89LipbMC05XSkoPz0uKlshQCNcXCQlXFxeJlxcKl0pKD89Lns4LH0pXCIpO1xuICAgICBcbiAgICAgICBpZiAoIWVtYWlsICYmICFwYXNzd29yZCkge1xuICAgICAgICAgICAgbnVtPTA7XG4gICAgICAgICAgICBkaWFsb2dzLmFsZXJ0KFwiQm90aCBmaWVsZHMgbWFuZGF0b3J5XCIpO1xuICAgICAgIFxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFlbWFpbCkge1xuICAgICAgICAgICAgZGlhbG9ncy5hbGVydChcIkVtYWlsIGNhbm5vdCBiZSBlbXB0eVwiKTtcbiAgICAgICAgICAgIG51bT0wO1xuICAgICAgICAgICAgfVxuICAgICAgIFxuICAgICAgICAgICAgZWxzZSBpZiAoZW1haWwgJiYgIXJlZ2V4cC50ZXN0KGVtYWlsKSkge1xuICAgICAgICAgICAgICAgIG51bT0wO1xuICAgICAgICAgICAgICAgIGRpYWxvZ3MuYWxlcnQoXCJJbnZhbGlkIGVtYWlsIGFkZHJlc3MuXCIpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgZWxzZSBpZiAoIXBhc3N3b3JkKSB7XG4gICAgICAgICAgICBudW09MDtcbiAgICAgICAgICAgIGRpYWxvZ3MuYWxlcnQoXCJQYXNzd29yZCBjYW5ub3QgYmUgZW1wdHlcIik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgXG4gICAgICAgICAgXG4gICAgXG4gICAgICAgICAgIGVsc2UgIGlmKHBhc3N3b3JkLmxlbmd0aDw2KVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG51bT0wO1xuICAgICAgICAgICAgICAgIGRpYWxvZ3MuYWxlcnQoXCJQYXNzd29yZCBzaG91bGQgYmUgbW9yZSB0aGFuIDYgY2hhcmFjdGVycyBcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAgIFxuICAgICAgICBpZihudW09PTEpXG4gICAgICAgIHtcbiAgICAgICAgLy8gPj4gZmV0Y2gtcG9zdC10c1xuICAgICAgICBmZXRjaChcImh0dHA6Ly9lYzItMTgtMjE4LTE3My0xNC51cy1lYXN0LTIuY29tcHV0ZS5hbWF6b25hd3MuY29tOjMwMDAvdXNlci9sb2dpblwiLCB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgaGVhZGVyczogeyBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIiB9LFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIGVtYWlsOiB2bS5nZXQoXCJ1c2VyXCIpLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB2bS5nZXQoXCJwYXNzXCIpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KS50aGVuKChyKSA9PiByLmpzb24oKSlcbiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgIC8vID4+IChoaWRlKVxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubWVzc2FnZSA9PSBcIkF1dGggc3VjY2Vzc2Z1bFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXZlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgcGFnZS5mcmFtZS5uYXZpZ2F0ZShcIi4vVHJhdmVsZXJfYWNjb3VudC9ob21lLXBhZ2VcIik7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFbWFpbCBub3QgZXhpc3RzLiBQbGVhc2UgU2lnbiBVcCAhIVwiKTtcbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBkaWFsb2dzLmFsZXJ0KFwiRW1haWwgbm90IGV4aXN0cy4gUGxlYXNlIFNpZ24gVXAgISFcIikudGhlbigoKT0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcbiAgICBcbiAgICAgICAgICAgIH0pLmNhdGNoKChlKSA9PiB7XG4gICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yOiBcIik7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSk7XG4gICAgXG4gICAgXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhZG1pbihhcmdzKSB7XG4gICAgICAgIGNvbnN0IHBhZ2UgPSBhcmdzLm9iamVjdC5wYWdlO1xuICAgICAgICBjb25zdCB2bSA9IHBhZ2UuYmluZGluZ0NvbnRleHQ7XG4gICAgICAgIHZhciBudW06bnVtYmVyID0gMTsgXG4gICAgICAgIGNvbnN0IGE9MDtcbiAgICAgICAgY29uc3QgZW1haWwgPSB2bS5nZXQoXCJ1c2VyXCIpO1xuICAgICAgICBjb25zdCBwYXNzd29yZD12bS5nZXQoXCJwYXNzXCIpO1xuICAgICAgIC8vIGNvbnNvbGUubG9nKGVtYWlsKTtcbiAgICBcbiAgICAgICAgY29uc3QgcmVnZXhwID0gbmV3IFJlZ0V4cCgvXigoW148PigpXFxbXFxdXFxcXC4sOzpcXHNAXCJdKyhcXC5bXjw+KClcXFtcXF1cXFxcLiw7Olxcc0BcIl0rKSopfChcIi4rXCIpKUAoKFxcW1swLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfVxcLlswLTldezEsM31dKXwoKFthLXpBLVpcXC0wLTldK1xcLikrW2EtekEtWl17Mix9KSkkL2kpO1xuICAgICAgICBjb25zdCBzdHJvbmdSZWdleCA9IG5ldyBSZWdFeHAoXCJeKD89LipbYS16XSkoPz0uKltBLVpdKSg/PS4qWzAtOV0pKD89LipbIUAjXFwkJVxcXiZcXCpdKSg/PS57OCx9KVwiKTtcbiAgICAgXG4gICAgXG4gICAgICAgIGlmICghZW1haWwpIHtcbiAgICAgICAgICAgIGRpYWxvZ3MuYWxlcnQoXCJBZG1pbiBFbWFpbCBjYW5ub3QgYmUgZW1wdHlcIik7XG4gICAgICAgICAgICBudW09MDtcbiAgICAgICAgICAgIH1cbiAgICAgICBcbiAgICAgICBcbiAgICAgICAgZWxzZSBpZiAoIXBhc3N3b3JkKSB7XG4gICAgICAgICAgICBudW09MDtcbiAgICAgICAgICAgIGRpYWxvZ3MuYWxlcnQoXCJBZG1pbiBQYXNzd29yZCBjYW5ub3QgYmUgZW1wdHlcIik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgZWxzZSAgaWYgKCFlbWFpbCAmJiAhcGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICBudW09MDtcbiAgICAgICAgICAgICAgICBkaWFsb2dzLmFsZXJ0KFwiQWRtaW4gRW1haWwgYW5kIHBhc3N3b3JkIGNhbm5vdCBiZSBlbXB0eVwiKTtcbiAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgICBcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgIGVsc2UgaWYoZW1haWw9PVwiYWRtaW4xQGFkbWluLmNvbVwiKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlmKHBhc3N3b3JkPT1cImFkbWluXCIpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHtcbiAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgcGFnZS5mcmFtZS5uYXZpZ2F0ZShcIi4vYWRtaW4vYWRtaW4tcGFnZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgZGlhbG9ncy5hbGVydChcIkFkbWluIFBhc3N3b3JkIGluY29ycmVjdFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBcbiAgICAgICAgZWxzZVxuICAgICAgICB7XG4gICAgICAgICAgICBkaWFsb2dzLmFsZXJ0KFwiQWRtaW4gRW1haWwgaXMgbm90IGNvcnJlY3RcIik7XG4gICAgICAgIH0gICAgIFxuICAgICAgICAgICAgICAgXG4gICAgXG4gICAgXG4gICAgICAgIH1cbiAgICAgICAgc2lnbnVwKGFyZ3MpXG57XG4gIFxuICAgIGNvbnN0IHBhZ2UgPSBhcmdzLm9iamVjdC5wYWdlO1xuICAgIGNvbnN0IHZtID0gcGFnZS5iaW5kaW5nQ29udGV4dDtcbiAgICBwYWdlLmZyYW1lLm5hdmlnYXRlKFwiLi9zaWdudXAvc2lnbnVwXCIpO1xuICAgIFxufVxuICAgIH1cbiAgICBcbiAgIFxuIl19