"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var dialogs = require("tns-core-modules/ui/dialogs");
var observable_1 = require("tns-core-modules/data/observable");
function onNavBtnTap(args) {
    var button = args.object;
    var page = button.page;
    page.frame.navigate("main-page");
}
exports.onNavBtnTap = onNavBtnTap;
function onNavigatingTo(args) {
    var page = args.object;
    var vm = new observable_1.Observable();
    vm.set("email", "");
    vm.set("password", "");
    vm.set("username", "");
    vm.set("prefer", "");
    page.bindingContext = vm;
}
exports.onNavigatingTo = onNavigatingTo;
function register(args) {
    var page = args.object.page;
    var vm = page.bindingContext;
    var num = 1;
    var email = vm.get("email");
    var password = vm.get("password");
    var password2 = vm.get("password2");
    var name = vm.get("username");
    // console.log(email);
    var regexp = new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/i);
    var strongRegex = new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\$%\^&\*])(?=.{8,})");
    if (!email) {
        num = 0;
        if (!name) {
            if (!password) {
                dialogs.alert("Email, Name,Password and Confirm Password required");
            }
            else {
                dialogs.login("Email and Name required");
            }
        }
        else {
            dialogs.login("Email required");
        }
    }
    else if (!name) {
        num = 0;
        if (!password) {
            dialogs.alert("Name,Password and Confirm Password required");
        }
        else {
            dialogs.login("Name required");
        }
    }
    else if (!password && !password2) {
        num = 0;
        dialogs.alert("Password and Confirm Password required");
    }
    else if (email && !regexp.test(email)) {
        num = 0;
        dialogs.alert("Invalid email format(e.g abc@gmail.com is valid)");
    }
    else if (password.length < 6) {
        num = 0;
        dialogs.alert("Password should be more than 6 characters");
    }
    else if (password != password2) {
        num = 0;
        dialogs.alert("Password and confirm password does not match");
    }
    if (num == 1) {
        // >> fetch-post-ts
        fetch("http://ec2-18-218-173-14.us-east-2.compute.amazonaws.com:3000/user/signup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                email: vm.get("email"),
                password: vm.get("password"),
                name: vm.get("username"),
                preference: vm.get("prefer")
            })
        }).then(function (r) { return r.json(); })
            .then(function (response) {
            var result = response;
            // >> (hide)
            if (result.message == "User created") {
                dialogs.alert("User created").then(function () {
                    console.log("Dialog closed!");
                });
                // console.log("Even");
                page.frame.navigate("./login-page/login-page");
            }
            else {
                dialogs.alert("Email already registered").then(function () {
                    console.log("Dialog closed!");
                });
            }
            // << (hide)
        }).catch(function (e) {
            // >> (hide)
            console.log("Error: ");
            console.log(e);
            // << (hide)
        });
        // << fetch-post-ts
    }
}
exports.register = register;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lnbnVwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic2lnbnVwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBSUEscURBQXVEO0FBR3ZELCtEQUE4RDtBQUU5RCxTQUFnQixXQUFXLENBQUMsSUFBZTtJQUd2QyxJQUFNLE1BQU0sR0FBbUIsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUMzQyxJQUFNLElBQUksR0FBUyxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQy9CLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQ3JDLENBQUM7QUFORCxrQ0FNQztBQUdELFNBQWdCLGNBQWMsQ0FBQyxJQUFJO0lBQy9CLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDekIsSUFBTSxFQUFFLEdBQUcsSUFBSSx1QkFBVSxFQUFFLENBQUM7SUFFNUIsRUFBRSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDcEIsRUFBRSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDdkIsRUFBRSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDdkIsRUFBRSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDckIsSUFBSSxDQUFDLGNBQWMsR0FBRyxFQUFFLENBQUM7QUFDN0IsQ0FBQztBQVRELHdDQVNDO0FBRUQsU0FBZ0IsUUFBUSxDQUFDLElBQUk7SUFDekIsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDOUIsSUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQztJQUMvQixJQUFJLEdBQUcsR0FBQyxDQUFDLENBQUM7SUFDVixJQUFNLEtBQUssR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzFCLElBQU0sUUFBUSxHQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFbEMsSUFBTSxTQUFTLEdBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNwQyxJQUFNLElBQUksR0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQy9CLHNCQUFzQjtJQUVyQixJQUFNLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyx5SkFBeUosQ0FBQyxDQUFDO0lBQ3JMLElBQU0sV0FBVyxHQUFHLElBQUksTUFBTSxDQUFDLGdFQUFnRSxDQUFDLENBQUM7SUFFakcsSUFBSSxDQUFDLEtBQUssRUFDVjtRQUFFLEdBQUcsR0FBQyxDQUFDLENBQUM7UUFDSixJQUFHLENBQUMsSUFBSSxFQUNSO1lBQ0ksSUFBRyxDQUFDLFFBQVEsRUFDWjtnQkFDSSxPQUFPLENBQUMsS0FBSyxDQUFDLG9EQUFvRCxDQUFDLENBQUM7YUFDdkU7aUJBRUQ7Z0JBQ0EsT0FBTyxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO2FBQ3hDO1NBQ0o7YUFFRDtZQUNJLE9BQU8sQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztTQUNuQztLQUVKO1NBQ0ksSUFBRyxDQUFDLElBQUksRUFDVDtRQUFDLEdBQUcsR0FBQyxDQUFDLENBQUM7UUFDSCxJQUFHLENBQUMsUUFBUSxFQUNaO1lBQ0ksT0FBTyxDQUFDLEtBQUssQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFDO1NBQ2hFO2FBRUQ7WUFDQSxPQUFPLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1NBQzlCO0tBQ0o7U0FDRyxJQUFHLENBQUMsUUFBUSxJQUFJLENBQUMsU0FBUyxFQUMxQjtRQUNJLEdBQUcsR0FBQyxDQUFDLENBQUM7UUFDTixPQUFPLENBQUMsS0FBSyxDQUFDLHdDQUF3QyxDQUFDLENBQUM7S0FDM0Q7U0FPRixJQUFJLEtBQUssSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUU7UUFDakMsR0FBRyxHQUFDLENBQUMsQ0FBQztRQUNOLE9BQU8sQ0FBQyxLQUFLLENBQUMsa0RBQWtELENBQUMsQ0FBQztLQUVyRTtTQUVHLElBQUcsUUFBUSxDQUFDLE1BQU0sR0FBQyxDQUFDLEVBQ3hCO1FBQ0ksR0FBRyxHQUFDLENBQUMsQ0FBQztRQUNOLE9BQU8sQ0FBQyxLQUFLLENBQUMsMkNBQTJDLENBQUMsQ0FBQztLQUM5RDtTQUNJLElBQUcsUUFBUSxJQUFFLFNBQVMsRUFDM0I7UUFDSSxHQUFHLEdBQUMsQ0FBQyxDQUFDO1FBQ04sT0FBTyxDQUFDLEtBQUssQ0FBQyw4Q0FBOEMsQ0FBQyxDQUFDO0tBRWpFO0lBRVgsSUFBRyxHQUFHLElBQUUsQ0FBQyxFQUNUO1FBRUUsbUJBQW1CO1FBQ25CLEtBQUssQ0FBQywyRUFBMkUsRUFBRTtZQUMvRSxNQUFNLEVBQUUsTUFBTTtZQUNkLE9BQU8sRUFBRSxFQUFFLGNBQWMsRUFBRSxrQkFBa0IsRUFBRTtZQUMvQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQztnQkFDakIsS0FBSyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO2dCQUN0QixRQUFRLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUM7Z0JBQzVCLElBQUksRUFBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQztnQkFDdkIsVUFBVSxFQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDO2FBRTlCLENBQUM7U0FDTCxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFSLENBQVEsQ0FBQzthQUNuQixJQUFJLENBQUMsVUFBQyxRQUFRO1lBQ1gsSUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDO1lBQ3hCLFlBQVk7WUFDWixJQUFJLE1BQU0sQ0FBQyxPQUFPLElBQUksY0FBYyxFQUFFO2dCQUVsQyxPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDL0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUNsQyxDQUFDLENBQUMsQ0FBQztnQkFDSix1QkFBdUI7Z0JBQ3RCLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLHlCQUF5QixDQUFDLENBQUM7YUFFbEQ7aUJBRUk7Z0JBQ0QsT0FBTyxDQUFDLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDM0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUVsQyxDQUFDLENBQUMsQ0FBQzthQUNOO1lBR0QsWUFBWTtRQUNoQixDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBQyxDQUFDO1lBQ1AsWUFBWTtZQUNaLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDdkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNmLFlBQVk7UUFDaEIsQ0FBQyxDQUFDLENBQUM7UUFDUCxtQkFBbUI7S0FDcEI7QUFDSCxDQUFDO0FBdEhELDRCQXNIQyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5pbXBvcnQgeyBMYWJlbCB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL2xhYmVsXCI7XHJcbmltcG9ydCB7IFBhZ2UgfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy91aS9wYWdlXCI7XHJcbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL2J1dHRvblwiO1xyXG5pbXBvcnQgKiBhcyBkaWFsb2dzIGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL2RpYWxvZ3NcIjtcclxuXHJcbmltcG9ydCB7IEV2ZW50RGF0YSB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL2RhdGEvb2JzZXJ2YWJsZVwiO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvZGF0YS9vYnNlcnZhYmxlXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gb25OYXZCdG5UYXAoYXJnczogRXZlbnREYXRhKVxyXG57XHJcblxyXG4gICAgY29uc3QgYnV0dG9uOiBCdXR0b24gPSA8QnV0dG9uPmFyZ3Mub2JqZWN0O1xyXG4gICAgY29uc3QgcGFnZTogUGFnZSA9IGJ1dHRvbi5wYWdlO1xyXG4gICAgcGFnZS5mcmFtZS5uYXZpZ2F0ZShcIm1haW4tcGFnZVwiKTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBvbk5hdmlnYXRpbmdUbyhhcmdzKSB7XHJcbiAgICBjb25zdCBwYWdlID0gYXJncy5vYmplY3Q7XHJcbiAgICBjb25zdCB2bSA9IG5ldyBPYnNlcnZhYmxlKCk7XHJcblxyXG4gICAgdm0uc2V0KFwiZW1haWxcIiwgXCJcIik7XHJcbiAgICB2bS5zZXQoXCJwYXNzd29yZFwiLCBcIlwiKTtcclxuICAgIHZtLnNldChcInVzZXJuYW1lXCIsIFwiXCIpO1xyXG4gICAgdm0uc2V0KFwicHJlZmVyXCIsIFwiXCIpO1xyXG4gICAgcGFnZS5iaW5kaW5nQ29udGV4dCA9IHZtO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXIoYXJncykge1xyXG4gICAgY29uc3QgcGFnZSA9IGFyZ3Mub2JqZWN0LnBhZ2U7XHJcbiAgICBjb25zdCB2bSA9IHBhZ2UuYmluZGluZ0NvbnRleHQ7XHJcbiAgICBsZXQgbnVtPTE7XHJcbiAgICBjb25zdCBlbWFpbCA9IHZtLmdldChcImVtYWlsXCIpO1xyXG4gICAgICAgIGNvbnN0IHBhc3N3b3JkPXZtLmdldChcInBhc3N3b3JkXCIpO1xyXG5cclxuICAgICAgICBjb25zdCBwYXNzd29yZDI9dm0uZ2V0KFwicGFzc3dvcmQyXCIpO1xyXG4gICAgICAgIGNvbnN0IG5hbWU9dm0uZ2V0KFwidXNlcm5hbWVcIik7XHJcbiAgICAgICAvLyBjb25zb2xlLmxvZyhlbWFpbCk7XHJcbiAgICBcclxuICAgICAgICBjb25zdCByZWdleHAgPSBuZXcgUmVnRXhwKC9eKChbXjw+KClcXFtcXF1cXFxcLiw7Olxcc0BcIl0rKFxcLltePD4oKVxcW1xcXVxcXFwuLDs6XFxzQFwiXSspKil8KFwiLitcIikpQCgoXFxbWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfV0pfCgoW2EtekEtWlxcLTAtOV0rXFwuKStbYS16QS1aXXsyLH0pKSQvaSk7XHJcbiAgICAgICAgY29uc3Qgc3Ryb25nUmVnZXggPSBuZXcgUmVnRXhwKFwiXig/PS4qW2Etel0pKD89LipbQS1aXSkoPz0uKlswLTldKSg/PS4qWyFAI1xcJCVcXF4mXFwqXSkoPz0uezgsfSlcIik7XHJcbiAgICAgXHJcbiAgICAgICAgaWYgKCFlbWFpbCApIFxyXG4gICAgICAgIHsgbnVtPTA7XHJcbiAgICAgICAgICAgIGlmKCFuYW1lKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZighcGFzc3dvcmQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9ncy5hbGVydChcIkVtYWlsLCBOYW1lLFBhc3N3b3JkIGFuZCBDb25maXJtIFBhc3N3b3JkIHJlcXVpcmVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZGlhbG9ncy5sb2dpbihcIkVtYWlsIGFuZCBOYW1lIHJlcXVpcmVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGRpYWxvZ3MubG9naW4oXCJFbWFpbCByZXF1aXJlZFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZighbmFtZSlcclxuICAgICAgICAgICAge251bT0wO1xyXG4gICAgICAgICAgICAgICAgaWYoIXBhc3N3b3JkKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ3MuYWxlcnQoXCJOYW1lLFBhc3N3b3JkIGFuZCBDb25maXJtIFBhc3N3b3JkIHJlcXVpcmVkXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgZGlhbG9ncy5sb2dpbihcIk5hbWUgcmVxdWlyZWRcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICBlbHNlIGlmKCFwYXNzd29yZCAmJiAhcGFzc3dvcmQyKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG51bT0wO1xyXG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ3MuYWxlcnQoXCJQYXNzd29yZCBhbmQgQ29uZmlybSBQYXNzd29yZCByZXF1aXJlZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgXHJcbiAgICBcclxuICAgICAgICBcclxuICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgICAgZWxzZSBpZiAoZW1haWwgJiYgIXJlZ2V4cC50ZXN0KGVtYWlsKSkge1xyXG4gICAgICAgICAgICAgICAgbnVtPTA7XHJcbiAgICAgICAgICAgICAgICBkaWFsb2dzLmFsZXJ0KFwiSW52YWxpZCBlbWFpbCBmb3JtYXQoZS5nIGFiY0BnbWFpbC5jb20gaXMgdmFsaWQpXCIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgZWxzZSBpZihwYXNzd29yZC5sZW5ndGg8NilcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbnVtPTA7XHJcbiAgICAgICAgICAgICAgICBkaWFsb2dzLmFsZXJ0KFwiUGFzc3dvcmQgc2hvdWxkIGJlIG1vcmUgdGhhbiA2IGNoYXJhY3RlcnNcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZihwYXNzd29yZCE9cGFzc3dvcmQyKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBudW09MDtcclxuICAgICAgICAgICAgICAgIGRpYWxvZ3MuYWxlcnQoXCJQYXNzd29yZCBhbmQgY29uZmlybSBwYXNzd29yZCBkb2VzIG5vdCBtYXRjaFwiKTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuIFxyXG4gIGlmKG51bT09MSlcclxuICB7XHJcbiAgICBcclxuICAgIC8vID4+IGZldGNoLXBvc3QtdHNcclxuICAgIGZldGNoKFwiaHR0cDovL2VjMi0xOC0yMTgtMTczLTE0LnVzLWVhc3QtMi5jb21wdXRlLmFtYXpvbmF3cy5jb206MzAwMC91c2VyL3NpZ251cFwiLCB7XHJcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgICBoZWFkZXJzOiB7IFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0sXHJcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgICBlbWFpbDogdm0uZ2V0KFwiZW1haWxcIiksXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiB2bS5nZXQoXCJwYXNzd29yZFwiKSxcclxuICAgICAgICAgICAgbmFtZTp2bS5nZXQoXCJ1c2VybmFtZVwiKSxcclxuICAgICAgICAgICAgcHJlZmVyZW5jZTp2bS5nZXQoXCJwcmVmZXJcIilcclxuXHJcbiAgICAgICAgfSlcclxuICAgIH0pLnRoZW4oKHIpID0+IHIuanNvbigpKVxyXG4gICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSByZXNwb25zZTtcclxuICAgICAgICAgICAgLy8gPj4gKGhpZGUpXHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQubWVzc2FnZSA9PSBcIlVzZXIgY3JlYXRlZFwiKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgZGlhbG9ncy5hbGVydChcIlVzZXIgY3JlYXRlZFwiKS50aGVuKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRGlhbG9nIGNsb3NlZCFcIik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJFdmVuXCIpO1xyXG4gICAgICAgICAgICAgICAgcGFnZS5mcmFtZS5uYXZpZ2F0ZShcIi4vbG9naW4tcGFnZS9sb2dpbi1wYWdlXCIpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGRpYWxvZ3MuYWxlcnQoXCJFbWFpbCBhbHJlYWR5IHJlZ2lzdGVyZWRcIikudGhlbigoKT0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRpYWxvZyBjbG9zZWQhXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAvLyA8PCAoaGlkZSlcclxuICAgICAgICB9KS5jYXRjaCgoZSkgPT4ge1xyXG4gICAgICAgICAgICAvLyA+PiAoaGlkZSlcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJFcnJvcjogXCIpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcclxuICAgICAgICAgICAgLy8gPDwgKGhpZGUpXHJcbiAgICAgICAgfSk7XHJcbiAgICAvLyA8PCBmZXRjaC1wb3N0LXRzXHJcbiAgfVxyXG59XHJcbiJdfQ==